# make sudo to enforce running on a real linux VM and not in a container on a macOS VM.
sudo: required
# do not use swift as language, since otherwise the build always runs on a macOS VM.
language: generic
dist: trusty # Ubuntu 14.04 LTS
osx_image: xcode9.3beta

compiler:
  - clang
# testing with geodesic does not work with gcc, see known issue in geodesic package
  # - gcc

os:
  - linux
  - osx

env:
  -  SWIFT_VERSION=4.0
  -  SWIFT_VERSION=4.1

before_install:
  - uname -a
  - |
    if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
      sudo apt-get update
      sudo apt-get install clang-3.6
    fi

install:
  - eval "$(curl -sL https://swiftenv.fuller.li/install.sh)"
  - swift --version

script:
  - swift build
  - swift test
  - |
    # lint on osx only (no need to do this on every platform)
    if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      swiftlint --strict
    fi
